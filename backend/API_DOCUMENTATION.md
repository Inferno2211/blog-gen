# Complete Backend API Documentation

## Base URL

```bash
http://localhost:5000/api/v1
```

## Overview

This is a comprehensive API documentation for the Blog Generation Platform backend. The API provides functionality for AI-powered article generation, domain management, article publishing, authentication, and static site generation.

## Authentication

All endpoints (except authentication endpoints) require admin authentication via JWT token in the Authorization header:

```http
Authorization: Bearer <jwt_token>
```

---

## üîê Authentication API

### Base URL: `/auth`

#### Login

**POST** `/auth/login`

Authenticate admin user and receive JWT token.

**Request Body:**

```json
{
  "email": "admin@example.com",
  "password": "password123"
}
```

**Response:**

```json
{
  "success": true,
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "expiresIn": "24h",
  "admin": {
    "id": "123e4567-e89b-12d3-a456-426614174000",
    "email": "admin@example.com",
    "name": "Admin User"
  }
}
```

#### Logout

**POST** `/auth/logout`

Logout admin user (requires authentication).

**Response:**

```json
{
  "success": true,
  "message": "Logged out successfully"
}
```

#### Get All Admins

**GET** `/auth/admins`

Retrieve all admin users.

**Response:**

```json
[
  {
    "id": "123e4567-e89b-12d3-a456-426614174000",
    "email": "admin@example.com",
    "name": "Admin User",
    "created_at": "2024-01-01T00:00:00.000Z"
  }
]
```

#### Create Admin

**POST** `/auth/admins`

Create a new admin user.

**Request Body:**

```json
{
  "email": "newadmin@example.com",
  "password": "securepassword123",
  "name": "New Admin"
}
```

#### Update Admin

**PUT** `/auth/admins/:id`

Update an existing admin user.

**Request Body:**

```json
{
  "email": "updatedadmin@example.com",
  "password": "newpassword123",
  "name": "Updated Admin"
}
```

#### Delete Admin

**DELETE** `/auth/admins/:id`

Delete an admin user.

---

## ü§ñ AI Generation API

### Base URL: `/ai`

#### Generate Article

**POST** `/ai/generateArticle`

Generate a new article with AI and create initial version.

**Request Body:**

```json
{
  "domain_id": "123e4567-e89b-12d3-a456-426614174000",
  "status": "DRAFT",
  "user": "john.doe",
  "niche": "Web Development",
  "keyword": "React",
  "topic": "Getting Started with React",
  "n": 3,
  "targetURL": "https://example.com",
  "anchorText": "Learn React",
  "model": "gemini-2.5-flash",
  "provider": "gemini",
  "maxRetries": 3,
  "userPrompt": "Write a comprehensive guide...",
  "internalLinkEnabled": false,
  "noExternalBacklinks": true
}
```

**Response:**

```json
{
  "articleId": "123e4567-e89b-12d3-a456-426614174000",
  "draft": {
    "versionId": "123e4567-e89b-12d3-a456-426614174001",
    "versionNum": 1,
    "content": "# Getting Started with React\n\n...",
    "qcResult": {
      "passed": true,
      "score": 85,
      "issues": []
    }
  },
  "status": "DRAFT"
}
```

#### Generate Article Version

**POST** `/ai/generateArticleVersion`

Generate a new version for an existing article.

**Request Body:**

```json
{
  "articleId": "123e4567-e89b-12d3-a456-426614174000",
  "provider": "gemini",
  "maxRetries": 3,
  "userPrompt": "Improve the introduction...",
  "internalLinkEnabled": false,
  "noExternalBacklinks": true
}
```

---

## üìù Articles API

### Base URL: `/articles`

#### Article Data Structure

**Article Model:**

```json
{
  "id": "123e4567-e89b-12d3-a456-426614174000",
  "domain_id": "123e4567-e89b-12d3-a456-426614174001",
  "slug": "sample-article",
  "status": "DRAFT",
  "created_at": "2024-01-01T00:00:00.000Z",
  "updated_at": "2024-01-01T00:00:00.000Z",
  "backlink_expiry": "2024-12-31T23:59:59.000Z",
  "user": "john.doe",
  "topic": "Technology",
  "niche": "Web Development",
  "keyword": "React",
  "backlink_target": "https://example.com",
  "anchor": "Learn React",
  "selected_version_id": "123e4567-e89b-12d3-a456-426614174002",
  "domain": {
    "id": "123e4567-e89b-12d3-a456-426614174001",
    "slug": "my-website",
    "name": "My Website",
    "url": "https://mywebsite.com",
    "tags": "blog, tech"
  },
  "versions": [
    {
      "id": "123e4567-e89b-12d3-a456-426614174002",
      "version_num": 1,
      "content_md": "# Sample Article\n\nContent...",
      "qc_attempts": 0,
      "last_qc_status": null,
      "created_at": "2024-01-01T00:00:00.000Z"
    }
  ]
}
```

**Article Status Values:**

- `DRAFT` - Article is in draft state
- `PUBLISHED` - Article has been published to domain
- `ARCHIVED` - Article has been archived
- `PENDING` - Article is pending review
- `GENERATED` - Article was generated by AI
- `FLAGGED_BY_AI` - Article was flagged by AI quality check
- `APPROVED_BY_AI` - Article was approved by AI quality check

#### CRUD Operations

##### Get All Articles

**GET** `/articles/getAllArticles`

Retrieve all articles with versions and domain information.

##### Get Article by ID

**GET** `/articles/getArticleById/:id`

Retrieve a specific article by ID.

##### Update Article

**PUT** `/articles/updateArticle/:id`

Update article metadata (not content).

**Request Body:**

```json
{
  "status": "PUBLISHED",
  "topic": "Updated Topic",
  "keyword": "Updated Keyword"
}
```

##### Delete Article

**DELETE** `/articles/deleteArticle/:id`

Delete an article and all its versions.

#### Version Management

##### Set Selected Version

**POST** `/articles/setSelectedVersion/:id`

Set which version of the article is the selected/active version.

**Request Body:**

```json
{
  "versionId": "123e4567-e89b-12d3-a456-426614174002"
}
```

##### Create Version from Editor

**POST** `/articles/createVersionFromEditor/:id`

Create a new version from editor content with optional AI processing.

**Request Body:**

```json
{
  "content_md": "# Updated Article\n\nNew content...",
  "model": "gemini-2.5-flash",
  "provider": "gemini"
}
```

#### Publishing Operations

##### Publish Article

**POST** `/articles/publishBlog/:id`

Publish an article to its associated domain. Creates/updates the static file.

**Response:**

```json
{
  "success": true,
  "message": "Blog published successfully!",
  "articleId": "123e4567-e89b-12d3-a456-426614174000",
  "file": "sample-article.md",
  "filePath": "/domains/my-website/src/content/blog/sample-article.md",
  "sanitizedSlug": "sample-article",
  "originalSlug": "sample-article",
  "article": { ... }
}
```

##### Update Published File

**PATCH** `/articles/publishBlog/:id`

Update an already published article's file (for republishing after edits).

**Request Body:**

```json
{
  "domainName": "my-website"
}
```

#### Content Editing

##### Edit Article Content

**PUT** `/articles/editArticleContent/:id`

Edit article content with optional AI processing. Handles both published and unpublished articles.

**Request Body:**

```json
{
  "content_md": "# Updated Content\n\nNew content here...",
  "model": "gemini-2.5-flash",
  "provider": "gemini",
  "useAI": false
}
```

**Response:**

```json
{
  "success": true,
  "message": "Article content updated directly in database",
  "articleId": "123e4567-e89b-12d3-a456-426614174000",
  "versionId": "123e4567-e89b-12d3-a456-426614174002",
  "versionNum": 2,
  "content": "# Updated Content\n\nNew content here...",
  "qcResult": { ... },
  "status": "DRAFT",
  "fileUpdated": false,
  "editMethod": "DIRECT_EDIT"
}
```

##### Direct Edit (No AI)

**PUT** `/articles/editArticleContentDirect/:id`

Direct edit without AI processing (faster for simple edits).

#### Backlink Management

##### Integrate Backlink

**POST** `/articles/integrateBacklink`

Regenerate article content with integrated backlinks.

**Request Body:**

```json
{
  "articleId": "123e4567-e89b-12d3-a456-426614174000",
  "backlinkUrl": "https://example.com",
  "anchorText": "Learn More",
  "model": "gemini-2.5-flash",
  "provider": "gemini"
}
```

##### Get Backlink Review Queue

**GET** `/articles/backlinkReviewQueue`

Get articles pending backlink review.

**Query Parameters:**

- `status` (default: "PENDING_REVIEW")
- `sortBy` (default: "created_at")
- `sortOrder` (default: "desc")

##### Approve Backlink

**POST** `/articles/approveBacklink/:versionId`

Approve a backlink integration.

**Request Body:**

```json
{
  "reviewNotes": "Backlink looks good"
}
```

##### Reject Backlink

**POST** `/articles/rejectBacklink/:versionId`

Reject a backlink integration.

**Request Body:**

```json
{
  "reviewNotes": "Backlink not relevant"
}
```

##### Approve and Publish

**POST** `/articles/approveAndPublish/:versionId`

Approve backlink and publish the article.

**Request Body:**

```json
{
  "reviewNotes": "Approved and published"
}
```

---

## üåê Domain Management API

### Base URL: `/domain`

#### Domain Data Structure

**Domain Model:**

```json
{
  "id": "123e4567-e89b-12d3-a456-426614174000",
  "name": "My Website",
  "slug": "my-website",
  "url": "https://mywebsite.com",
  "tags": "blog, tech, personal",
  "created_at": "2024-01-01T00:00:00.000Z",
  "articleCount": 5,
  "articles": [
    {
      "id": "123e4567-e89b-12d3-a456-426614174001",
      "slug": "sample-article",
      "topic": "Sample Topic",
      "status": "PUBLISHED"
    }
  ]
}
```

#### Domain CRUD Operations

##### Create Domain

**POST** `/domain/createDomain`

Create a new domain.

**Request Body (Single):**

```json
{
  "name": "My Website",
  "slug": "my-website",
  "url": "https://mywebsite.com",
  "tags": "blog, tech"
}
```

**Request Body (Bulk):**

```json
{
  "domains": [
    {
      "name": "Tech Blog",
      "slug": "tech-blog",
      "url": "https://techblog.com"
    }
  ],
  "tags": "blog, tech"
}
```

##### Get Domain by ID

**GET** `/domain/getDomain/:id`

Retrieve a specific domain by ID.

##### Get All Domains

**GET** `/domain/getAllDomains`

Retrieve all domains with article counts.

##### Update Domain

**PUT** `/domain/updateDomain/:id`

Update domain information.

**Request Body:**

```json
{
  "name": "Updated Website Name",
  "url": "https://updatedwebsite.com",
  "tags": "blog, tech, updated"
}
```

##### Delete Domain

**DELETE** `/domain/deleteDomain/:id`

Delete a domain (only if no associated articles).

#### Template/Layout Management

##### Get Available Templates

**GET** `/domain/getAvailableTemplates`

Get list of available Astro templates/layouts.

**Response:**

```json
{
  "success": true,
  "templates": [
    "ModernLayout.astro",
    "MinimalLayout.astro",
    "MicroblogLayout.astro"
  ],
  "count": 3
}
```

##### Create Domain Folder

**POST** `/domain/createDomainFolder`

Create a new domain folder by copying a template.

**Request Body:**

```json
{
  "domainName": "my-website",
  "overwrite": false
}
```

##### Switch Domain Template

**PUT** `/domain/switchDomainTemplate`

Change the template/layout for an existing domain.

**Request Body:**

```json
{
  "domainName": "my-website",
  "newLayoutName": "ModernLayout.astro"
}
```

##### Get Domain Layout

**GET** `/domain/getDomainLayout/:domainName`

Get the current layout/template for a domain.

##### List Domains

**GET** `/domain/listDomains`

List all domain folders in the file system.

#### Blog Operations

##### Add Article to Domain

**POST** `/domain/addArticleToDomain`

Add an article to a domain (create/update the static file).

**Request Body:**

```json
{
  "articleId": "123e4567-e89b-12d3-a456-426614174000",
  "domainSlug": "my-website"
}
```

#### Build Operations

##### Build Domain

**POST** `/domain/buildDomain/:domainName`

Build the domain (npm install + npm run build).

##### Download Domain

**GET** `/domain/downloadDomain/:domainName`

Download the built domain as a ZIP file.

##### Get Domain Status

**GET** `/domain/getDomainStatus/:domainName`

Get the build status and information for a domain.

---

## üìä Error Responses

### Standard Error Format

```json
{
  "error": "Error message",
  "code": "ERROR_CODE",
  "timestamp": "2024-01-01T00:00:00.000Z",
  "details": "Additional error details"
}
```

### Common HTTP Status Codes

- `200` - Success
- `201` - Created
- `400` - Bad Request
- `401` - Unauthorized
- `403` - Forbidden
- `404` - Not Found
- `409` - Conflict
- `500` - Internal Server Error
- `507` - Insufficient Storage

### Common Error Codes

- `MISSING_CREDENTIALS` - Email/password missing
- `INVALID_CREDENTIALS` - Wrong email/password
- `INVALID_EMAIL` - Email format invalid
- `WEAK_PASSWORD` - Password doesn't meet requirements
- `MISSING_REQUIRED_FIELDS` - Required fields missing
- `ARTICLE_NOT_FOUND` - Article doesn't exist
- `DOMAIN_NOT_FOUND` - Domain doesn't exist
- `VERSION_NOT_FOUND` - Article version doesn't exist

---

## üîß Development Notes

### Environment Variables

```env
DATABASE_URL=postgresql://user:password@localhost:5432/blog_gen
JWT_SECRET=your_jwt_secret_here
JWT_EXPIRES_IN=24h
GEMINI_API_KEY=your_gemini_api_key
```

### Database Schema

The API uses Prisma ORM with PostgreSQL. Key tables:

- `Admin` - Admin users
- `Domain` - Website domains
- `Article` - Articles with metadata
- `ArticleVersion` - Article content versions

### File Structure

- `astro-builds/domains/` - Generated domain websites
- `astro-builds/templates/` - Astro templates
- Static files are generated in domain folders

### Rate Limiting

Consider implementing rate limiting for AI generation endpoints to prevent abuse.

---

*Last updated: September 5, 2025*
*API Version: v1*
